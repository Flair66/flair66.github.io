<!doctype html>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<title>Speisekarte - Flair66</title>

		<link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
		<style>
			@keyframes blinking {
				0% {
					transform: rotate(-10deg) scale(0.9);
				}
				50% {
					transform: rotate(-10deg) scale(1.2);
				}
				100% {
					transform: rotate(-10deg) scale(0.9);
				}
			}
			.new {
				position: absolute !important;
				top: 3.5rem;
				right: 1.2rem;
				font-family: "Bangers", cursive;
				font-size: 2rem;
				font-weight: bolder;
				letter-spacing: 10px;
				text-transform: uppercase;
				color: #bfaa40;
				text-shadow: 1px 1px #ac9939, 2px 2px #998833, 3px 3px #86772d, 4px 4px #82742b, 5px 5px #7e702a, 6px 6px #7a6d29, 7px 7px 16px rgba(0, 0, 0, 0.7);
				animation: blinking 1.5s ease-in-out infinite;
				z-index: 100;
			}
		</style>
	</head>
	<body class="bg-light">
		<main class="container-md">
			<div class="mt-5 mb-4 text-center">
				<img width="80%" src="./flair.svg">
			</div>
			<div id="hhalert" class="alert alert-success text-center" role="alert">
				<strong>Happy Hour</strong><br>
				Sonntag bis Donnerstag von 17-20 Uhr gelten die grünen Happy Hour Preise.
			</div>
			<div class="alert alert-info text-center" role="alert">
				<strong>Bottled Cocktails - This is the way!</strong><br>
				Liebe Gäste bitte beachten Sie aus hygienischen Gründen werden die Cocktails in einer Flasche verkauft.
				Daher fallen pro Flasche 2€ Pfand an.
				Ihre leeren Flaschen können Sie immer zu unseren Öffnungszeiten zurück bringen.
				<br>
				<a href="./bottled.html" class="btn btn-sm btn-outline-secondary mt-2">
					Was sind Bottled Cocktails und wie funktioniert's?
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16" style="margin-top: -0.15rem; margin-left: -0.2rem">
						<path d="M12.14 8.753l-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
					</svg>
				</a>
			</div>
			<div class="alert alert-success" role="alert">
				<h4 class="alert-heading">
					Samstags Aktion:
				</h4>
				<p>
					Zwei Cocktails ihrer Wahl sowie eine Mix Beilage für nur 20€.
				</p>
			</div>
			<div id="searchcard" class="card mb-4">
				<div class="card-body p-3">
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text">
								<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
									<path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
								</svg>
							</span>
						</div>
						<div id="search_result" class="dropdown-menu" style="width: 100%;"></div>
						<input type="text" id="search_input" class="form-control" placeholder="Suche:" oninput="search()" onclick="search()" onblur="window.setTimeout(() => { document.getElementById('search_result').classList.remove('d-block'); }, 250)">
					</div>
					<p class="m-0">
						<small>
							<b>Tipp:</b>
							Unsere Suche findet für Sie Ihren neuen Lieblings-Cocktail nicht nur nach seinem Namen sondern auch nach seinen Zutaten. Deshalb wenn Sie das nächste mal Lust auf Mango haben, suchen Sie einfach danach.
						</small>
					</p>
				</div>
			</div>
			<div class="card mb-4">
				<div class="card-body p-3">
					<div id="content" class="row px-3"></div>
				</div>
			</div>
		</main>

		<footer>
			<p class="pt-2 pb-3 text-center">
				<a href="./impressum.html">
					Impressum & Datenschutzerklärung
				</a>
				<br>
				<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.de">
					CC BY-NC-SA 4.0
				</a>
			</p>
		</footer>

		<div class="modal fade" id="welcomemodal" data-backdrop="static" data-keyboard="true" data-focus="true" data-show="true" tabindex="-1" role="dialog" aria-labelledby="welcomelabel" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title" id="welcomelabel">Herzlich Willkommen!</h3>
					</div>
					<div class="modal-body">
						<p>
							Liebe Gäste, Willkommen auf der digitalen Getränkekarte des Flair66.
							Auf Grund der aktuellen Situation dürfen wir Ihnen nur Bottled Cocktails anbieten.
						</p>
						<a href="./bottled.html" class="btn btn-sm btn-block btn-info mt-2">
							Was sind Bottled Cocktails?
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16" style="margin-top: -0.15rem; margin-left: -0.2rem">
								<path d="M12.14 8.753l-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
							</svg>
						</a>
						<hr>
						<p>
							Ab sofort bieten wir Ihnen wieder unser <strong>Essen</strong> an.
							Ich muss sie aber bitten es <strong>am Vortag vorzubestellen</strong>, damit wir alles für Sie frisch anbieten können.
						</p>
						<hr>
						<h4>Unsere Öffnungszeiten:</h4>
						<dl class="row mx-0">
							<dt class="col-5 text-right">
								<strong>Montag:</strong>
							</dt>
							<dd class="col-7 text-secondary">
								17:00 Uhr - 20:00 Uhr
							</dd>
							<dt class="col-5 text-right">
								<strong>Dienstag:</strong>
							</dt>
							<dd class="col-7 text-secondary">
								17:00 Uhr - 20:00 Uhr
							</dd>
							<dt class="col-5 text-right">
								<strong>Mittwoch:</strong>
							</dt>
							<dd class="col-7 text-secondary">
								17:00 Uhr - 20:00 Uhr
							</dd>
							<dt class="col-5 text-right">
								<strong>Donnerstag:</strong>
							</dt>
							<dd class="col-7 text-secondary">
								17:00 Uhr - 20:00 Uhr
							</dd>
							<dt class="col-5 text-right">
								<strong>Freitag:</strong>
							</dt>
							<dd class="col-7">
								17:00 Uhr - 22:00 Uhr
							</dd>
							<dt class="col-5 text-right">
								<strong>Samstag:</strong>
							</dt>
							<dd class="col-7">
								17:00 Uhr - 22:00 Uhr
							</dd>
							<dt class="col-5 text-right">
								<strong>Sonntag:</strong>
							</dt>
							<dd class="col-7 text-secondary">
								17:00 Uhr - 20:00 Uhr
							</dd>
						</dl>
					</div>
					<div class="modal-footer justify-content-between">
						<a class="btn btn-outline-info text-info" href="https://www.baden-wuerttemberg.de/de/service/aktuelle-infos-zu-corona/aktuelle-corona-verordnung-des-landes-baden-wuerttemberg/" target="_blank">
							Aktuelle Corona-Verordnung
						</a>
						<button type="button" class="btn btn-success" data-dismiss="modal">
							Zur Karte
							<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-double-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="margin-top: -0.15rem; margin-left: -0.2rem">
								<path fill-rule="evenodd" d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708z"/>
								<path fill-rule="evenodd" d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708z"/>
							</svg>
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="detailmodal" data-keyboard="true" data-focus="true" tabindex="-1" role="dialog" aria-labelledby="detaillabel" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title" id="detaillabel"></h3>
					</div>
					<div id="detailbody" class="modal-body"></div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-dismiss="modal">
							<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-double-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
								<path fill-rule="evenodd" d="M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
								<path fill-rule="evenodd" d="M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
							</svg>
							Zurück
						</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
		<script>
			// Old version fix
			if (!(String.prototype.replaceAll && typeof String.prototype.replaceAll === 'function')) {
				String.prototype.replaceAll = function(search, replacement) {
					var target = this;
					return target.split(search).join(replacement);
				};
			}

			var settings = {
				"search": true,
				"navbtns": true,
				"scrolltonav": true,
				"hh": true
			};

			var detail_modal_data = [];
			var search_index = {};

			function normalize_token(token) {
				return token.toLowerCase()
						.replaceAll("ç", "c")
						.replaceAll("ñ", "n")
						.replaceAll("ú", "u")
						.replaceAll("é", "e")
						.replaceAll("è", "e")
						.replaceAll("ä", "a")
						.replaceAll("ö", "o")
						.replaceAll("ü", "u")
						.replaceAll("ß", "ss")
						.replaceAll("minze", "minz")
						.replaceAll("whiske", "whisk")
						.replaceAll("whiskey", "whisky")
						.replaceAll(/[^a-z0-9]/g, "");
			}

			function add_to_search_index(id, entry, parent) {
				function normalize_and_add_to_index(key) {
					let _key = normalize_token(key);
					if (!search_index[_key]) {
						search_index[_key] = [ id ];
					} else {
						search_index[_key].push(id);
					}
				}

				normalize_and_add_to_index(id);
				normalize_and_add_to_index(parent);

				if (entry["searchterms"]) {
					entry["searchterms"].forEach(element => {
						normalize_and_add_to_index(element);
					});
				}

				if (entry["badges"]) {
					entry["badges"].forEach(element => {
						normalize_and_add_to_index(element.name);
					});
				}

				if (entry["ingredients"]) {
					let keys = entry["ingredients"].split(/,|-/);

					keys.forEach(element=> {
						let key = normalize_token(element);

						if (key === "") return;
						if (key === "vol") return;
						if (key.endsWith("vol")) return;
						if (key.endsWith("jahre")) return;

						if (!search_index[key]) {
							search_index[key] = [ id ];
						} else {
							search_index[key].push(id);
						}
					});
				}
			}

			function create_entrys(entries, container, search_parent) {
				entries.forEach(element => {
					let id = normalize_token(element.name);

					if (settings.search) {
						add_to_search_index(element.name, element, search_parent);
					}

					let detail_id = 0;
					if (element.detail) {
						detail_id = detail_modal_data.length;
						detail_modal_data.push(element.detail);
					}


					function get_badge_html() {
						if (!element.badges) return '';

						badge_html = '<br>';
						element.badges.forEach(badge => {
							badge_html += `
								<span class="badge badge-pill badge-${badge.type}">
									${badge.name}
								</span>
							`;
						});

						return badge_html;
					}

					if (element.sizes) {
						function helper(id) {
							if (element.sizes[id]) {
								return `
									<li class="list-group-item border-0 d-flex justify-content-between align-items-center p-1">
										<div>
											${element.sizes[id].glass ? '<img src="glassware/' + element.sizes[id].glass + '.svg" height="20px" class="mr-2 float-left"/>' : ''}
											${element.sizes[id].size}
										</div>
										<span class="badge badge-secondary badge-pill">
											${element.sizes[id].price}
										</span>
									</li>
								`;
							} else return '';
						}

						container.insertAdjacentHTML('beforeend', `
							<li id="${id}" class="list-group-item px-1 position-relative" style="padding-left: 31px !important" ${element.detail ? 'onclick="run_detail_modal(' + detail_id + ')"' : ''}>
								<div class="float-right pr-3 ${element.detail ? '' : 'd-none'}" style="margin: -0.1em 0">
									<svg width="1.25em" height="1.25em" viewBox="0 0 16 16" class="bi bi-info-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
										<path d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588z"/>
										<circle cx="8" cy="4.5" r="1"/>
									</svg>
								</div>
								${element.glass ? '<img src="glassware/' + element.glass + '.svg" height="30px" class="mr-2 float-left position-absolute" style="top: 50%;margin-left: -31px;transform: translateY(-50%)"/>' : ''}
								<h5 class="m-0 pr-3">
									${element.name}
									<small class="text-muted">${element.ingredients ? element.ingredients : ''}</small>
								</h5>
								<ul class="list-group">
									${helper(0)}
									${helper(1)}
									${helper(2)}
									${helper(3)}
								</ul>
							</li>
						`);
					} else {
						container.insertAdjacentHTML('beforeend', `
							<li id="${id}" class="list-group-item d-flex justify-content-between align-items-center px-1" ${element.detail ? 'onclick="run_detail_modal(' + detail_id + ')"' : ''}>
								<div class="d-flex" style="align-items: center;">
									${element.glass ? '<img src="glassware/' + element.glass + '.svg" height="30px" class="mr-2" style="margin-top: -10px"/>' : ''}
									<h5 class="m-0 pr-3">
										${element.name}
										<small class="text-muted">${element.size ? element.size : ''}</small>
										<br>
										<small class="text-muted">${element.ingredients ? element.ingredients : ''}</small>
										${get_badge_html()}
									</h5>
								</div>
								<div class="d-flex align-items-center">
									<div class="mr-2 ${element.detail ? '' : 'd-none'}">
										<svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-info-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
											<path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
											<path d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588z"/>
											<circle cx="8" cy="4.5" r="1"/>
										</svg>
									</div>
									<div>
										${settings.hh && element.hh ? '<span class="badge badge-success badge-pill">' + element.hh + '</span><br>' : ""}
										<span class="badge badge-secondary badge-pill">${element.price}</span>
										${element.deposit ? '<br><span class="badge badge-info badge-pill">+2,00€</span>' : ""}
									</div>
								</div>
							</li>
						`);
					}
				});
			}

			function create_block(block) {
				if (settings.navbtns) {
					document.getElementById('content').insertAdjacentHTML('beforeend', `
						<div class="col-sm-6 col-md-4 col-lg-3 p-1">
							<button class="btn btn-outline-dark btn-block" onclick="document.getElementById('block-${block.id}').scrollIntoView(true)">${block.name}</button>
						</div>
					`);
				}
				document.getElementsByTagName('main')[0].insertAdjacentHTML('beforeend', `
					<div id="block-${block.id}" class="card mb-4">
						<div class="card-body p-3">
							<h2 class="card-title">
								<p class="new ${block.new ? '' : 'd-none'}">Neu!</p>
								<button class="float-right btn btn-outline-secondary ${settings.scrolltonav ? '' : 'd-none'}" onclick="window.scrollTo({ top: 0 })">
									<svg class="bi bi-chevron-double-up text-width" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path fill-rule="evenodd" d="M7.646 2.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 3.707 2.354 9.354a.5.5 0 1 1-.708-.708l6-6z"/>
										<path fill-rule="evenodd" d="M7.646 6.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 7.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
									</svg>
								</button>
								<u>${block.name}</u>
							</h2>
							<ul id="ul-${block.id}" class="accordion list-group list-group-flush p-2">
							</ul>
						</div>
					</div>
				`);

				let container = document.getElementById('ul-' + block.id);
				if (block.entries) {
					create_entrys(block.entries, container, block.name);
				}
				if (block.blocks) {
					block.blocks.forEach(subblock => {
						container.insertAdjacentHTML('beforeend', `
							<li id="label-${subblock.id}" class="list-group-item d-flex px-1" style="border: none">
								<button class="btn btn-outline-dark btn-block" type="button" data-toggle="collapse" data-target="collapse-${subblock.id}" onclick="$('#collapse-${subblock.id}').toggleClass('d-none')">
									${subblock.name}
								</button>
							</li>
							<div id="collapse-${subblock.id}" class="list-group-flush d-none" aria-labelledby="label-${subblock.id}"></div>
						`);
						create_entrys(subblock.entries, document.getElementById('collapse-' + subblock.id), subblock.name);
					})
				}
			}

			function search() {
				let search_text = normalize_token(document.getElementById('search_input').value);
				let result = [];

				if (search_text === "") {
					document.getElementById('search_result').classList.remove('d-block');
					return;
				}
				document.getElementById('search_result').classList.add('d-block');

				document.getElementById('search_input').value.split(" ").map(element => {
					return normalize_token(element);
				}).filter(element => {
					return element !== "";
				}).forEach((search_term, index) => {
					let intermediate = [];
					Object.keys(search_index).filter(key => {
						return key.indexOf(search_term) !== -1;
					}).forEach(term => {
						search_index[term].forEach(id => {
							if (intermediate.indexOf(id) === -1) {
								intermediate.push(id);
							}
						});
					});

					if (index === 0) {
						result = intermediate;
					} else {
						result = result.filter(element => {
							return intermediate.indexOf(element) !== -1;
						});
					}
				});

				if (result.length === 0) {
					document.getElementById('search_result').innerHTML = '<span class="dropdown-item-text">Kein Ergebnis</span>';
				} else {
					document.getElementById('search_result').innerHTML = '';

					result.sort().forEach(id => {
						document.getElementById('search_result').insertAdjacentHTML('beforeend', `
							<button class="dropdown-item" type="button"
									onclick="scrollAsIWant('${normalize_token(id)}')">
									${id}</button>
						`);
					});
				}
			}

			function scrollAsIWant(id) {
				if (document.getElementById(id).parentElement.localName === 'div') {
					document.getElementById(id).parentElement.classList.remove('d-none');
				}

				document.getElementById(id).scrollIntoView(true);
			}

			function run_detail_modal(id) {
				document.getElementById('detaillabel').innerText = detail_modal_data[id].title;

				let container = document.getElementById('detailbody');
				container.innerHTML = '';
				detail_modal_data[id].blocks.forEach(block => {
					if (block.type === 'text') {
						container.insertAdjacentHTML('beforeend', `
							<p class="mb-3">${block.content}</p>
						`);
					} else if (block.type === 'image') {
						container.insertAdjacentHTML('beforeend', `
							<img class="mb-3" width="100%" src="./data/${block.content}">
						`);
					}
				});

				$('#detailmodal').modal('show');
			}

			$('#welcomemodal').modal('show');
			async function run() {
				let raw_data = await fetch("./data.json");
				let data = await raw_data.json();
				settings = data.settings;

				if (!settings.search) {
					document.getElementById('searchcard').classList.add("d-none");
				}
				if (!settings.navbtns) {
					document.getElementById('content').parentNode.parentNode.classList.add("d-none");
				}
				if (!settings.hh) {
					document.getElementById('hhalert').classList.add("d-none");
				}

				data.blocks.forEach(block => {
					create_block(block);
				});

				document.getElementsByTagName('main')[0].insertAdjacentHTML('beforeend', `
					<div class="alert alert-warning text-center" role="alert">
						<strong>Lieblings-Cocktail nicht dabei?</strong>
						Zögern Sie bitte nicht uns darauf anzusprechen wenn Sie ihre Bestellung aufgeben.
					</div>
				`);
			}
			run();
		</script>
	</body>
</html>
